<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>상품 등록 - LUCKYBOX</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f6f7fb; margin:0; padding:24px; }
    .wrap { max-width:720px; margin:0 auto; }
    h1 { margin:8px 0 16px; }
    .card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.06); }
    .row { display:grid; gap:12px; grid-template-columns: 1fr; }
    label { font-weight:600; }
    input, textarea { width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; }
    textarea { min-height:120px; resize:vertical; }
    .actions { display:flex; gap:8px; margin-top:8px; }
    button { padding:12px 16px; border:none; border-radius:8px; background:#111; color:#fff; cursor:pointer; }
    button[disabled] { opacity:.6; cursor:not-allowed; }
    .note { color:#555; font-size:14px; }
    #msg { margin-top:12px; min-height:20px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>상품 등록</h1>
    <div class="card">
      <!-- ✅ 숨은 iframe: 응답을 여기로 받음 (CORS 회피) -->
      <iframe name="hiddenIframe" style="display:none;"></iframe>

      <!-- ✅ 폼 제출: Apps Script doPost가 e.parameter로 받음 -->
      <form id="addProductForm"
            action="https://script.google.com/macros/s/AKfycbzr0NdCE6bMyz8J3Z4nKocZPECabcuZQzUEMjt9lbudyHmpebfGrK9ut1Xus_WUvewd/exec"
            method="POST"
            target="hiddenIframe">
        <input type="hidden" name="type" value="product" />

        <label>상품명 *</label>
        <input name="productName" type="text" placeholder="예) Chrome Hearts 시계" required />

        <label>이미지 URL *</label>
        <input name="productImage" type="url" placeholder="https:// 로 시작하는 공개 이미지 1개" required />

        <label>설명</label>
        <textarea name="productDescription" placeholder="가격/구성/주의사항 등"></textarea>

        <label>마감일 (선택)</label>
        <input name="productDeadline" type="datetime-local" />

        <div class="actions" style="display:flex; gap:8px; margin-top:8px;">
          <button type="submit">등록하기</button>
          <a href="products.html"><button type="button" style="background:#666">상품 목록</button></a>
        </div>
      </form>

      <p id="msg" style="margin-top:12px;"></p>
    </div>
  </div>

  <script>
    const msg = (t)=> document.getElementById('msg').innerText = t || '';

    // 폼 제출 시 진행 메시지
    document.getElementById('addProductForm').addEventListener('submit', () => {
      msg('⏳ 등록 처리 중…');
      // 5초 내 응답이 없으면 시트 확인 안내
      setTimeout(() => {
        if (!document.__luky_posted) {
          msg('✅ 등록이 완료되었을 수 있습니다. (시트를 확인해 주세요)');
        }
      }, 5000);
    });

    // ✅ Apps Script doPost가 postMessage로 성공/실패를 보내도록 되어 있음
    window.addEventListener('message', (ev) => {
 if (ev.data.result === 'success') {
  msg('✅ 등록 완료! 곧 목록으로 이동합니다…');
  setTimeout(() => {
    location.href = `products.html?added=${Date.now()}`; // ← 캐시 무력화
  }, 600);
}
     if (!ev.data || !ev.data.result) return;
      document.__luky_posted = true;
      if (ev.data.result === 'success') {
        msg('✅ 등록 완료! products.html에서 확인하세요.');
      } else {
        msg('⚠️ 등록 실패: ' + (ev.data.message || '알 수 없는 오류'));
      }
    });
  </script>
</body>
</html>
