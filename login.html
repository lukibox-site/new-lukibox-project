<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ë¡œê·¸ì¸ - LUCKYBOX</title>
  <style>
    body { font-family: Arial, sans-serif; display:flex; align-items:center; justify-content:center; min-height:100vh; background:#f6f7fb; }
    .card { background:#fff; padding:24px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.08); width:360px; }
    input { width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:8px; }
    .row { display:flex; gap:8px; }
    button { flex:1; padding:12px; border:none; border-radius:8px; background:#111; color:#fff; cursor:pointer; }
    button:hover { opacity:.92; }
    #msg { margin-top:10px; min-height:20px; color:#444; }
  </style>
</head>
<body>
  <div class="card">
    <h2>ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h2>
    <input id="email" type="email" placeholder="ì´ë©”ì¼" />
    <input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" />
    <div class="row">
      <button onclick="login()">ë¡œê·¸ì¸</button>
      <button onclick="signup()">íšŒì›ê°€ì…</button>
    </div>
    <p id="msg"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    // ğŸ”§ ì—¬ê¸°ì— ë³¸ì¸ Firebase ì„¤ì •ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (Console > í”„ë¡œì íŠ¸ > ì›¹ì•± ë“±ë¡ ì‹œ ì œê³µ)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      appId: "YOUR_APP_ID",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzr0NdCE6bMyz8J3Z4nKocZPECabcuZQzUEMjt9lbudyHmpebfGrK9ut1Xus_WUvewd/exec";
    const msg = (t)=> document.getElementById('msg').innerText = t;

    async function upsertCustomer(user) {
      try {
        await fetch(WEBAPP_URL, {
          method: 'POST',
          headers: { 'Content-Type':'application/json' },
          body: JSON.stringify({ type:'userUpsert', uid: user.uid, email: user.email || '' })
        });
      } catch(e) {
        console.error('upsert error', e);
      }
    }

    window.login = async () => {
      const email = document.getElementById('email').value.trim();
      const pw = document.getElementById('pw').value.trim();
      try {
        const u = await signInWithEmailAndPassword(auth, email, pw);
        await upsertCustomer(u.user);
        msg('âœ… ë¡œê·¸ì¸ ì„±ê³µ');
        const to = new URLSearchParams(location.search).get('redirect') || 'products.html';
        location.href = to;
      } catch (e) {
        msg('âš ï¸ ' + e.message);
      }
    };

    window.signup = async () => {
      const email = document.getElementById('email').value.trim();
      const pw = document.getElementById('pw').value.trim();
      try {
        const u = await createUserWithEmailAndPassword(auth, email, pw);
        await upsertCustomer(u.user);
        msg('âœ… íšŒì›ê°€ì… ì™„ë£Œ. ë¡œê·¸ì¸ ì¤‘â€¦');
        const to = new URLSearchParams(location.search).get('redirect') || 'products.html';
        location.href = to;
      } catch (e) {
        msg('âš ï¸ ' + e.message);
      }
    };

    // ë¡œê·¸ì¸ ìƒíƒœë©´ í•„ìš” ì‹œ ìë™ ë³µê·€
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // const to = new URLSearchParams(location.search).get('redirect') || 'products.html';
        // location.href = to;
      }
    });
  </script>
</body>
</html>
